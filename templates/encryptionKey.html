{% extends 'index.html' %}
{% block content %}

<b style="color: red;">{{error_message}}</b>

<h1>Setting up your encryption key.</h1>
<p>This step is very important. Please read carefuly.</p>
<p>Please write in a word or phrase that will be easily remembered by you. This will be used as your (and only your) encryption key. If you loose or forget this key, all the data stored on this service will be lost and unrecoverable.</p>
<p>Enter this phrase in the input box below. This phrase / word is NOT stored on the server. You will be asked to write this phrase / word in each time you log in from a different computer.</p>

<input type="text" id="encryption_key_value">

<script>
    if(typeof(Storage) == "undefined"){
        document.write("<p style='color: red;'>Sorry, local storage isn't available on your browser. Please try using MediSec with a newer browser.</p>")
    }

    function download() {
        var element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent($('#encryption_key_value')[0].value));
        element.setAttribute('download', "MediSecEncryptionKey.key");

        element.style.display = 'none';
        document.body.appendChild(element);

        element.click();

        document.body.removeChild(element);

        window.localStorage.setItem("MediSecEncryptionKey", $('#encryption_key_value')[0].value);
    }
</script>
<input type="button" value="Download & Save my key." onclick="download()">

<input type="button" value="Save the key." onclick="window.localStorage.setItem('MediSecEncryptionKey', $('#encryption_key_value')[0].value);">

<p>You can also download your phrase as a file, and store it somewhere just in case.</p>
<p>We recommend storing this file on the cloud, like <a href="http://drive.google.com">Google Drive</a> or <a href="http://dropbox.com">DropBox</a>.</p>

<a href="{{url_for('medicalHistory')}}">I'm done here - I have my key remembered and saved!</a>

{% endblock content %}